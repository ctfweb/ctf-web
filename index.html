<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Collapsible sidebar using Bootstrap 4</title>

    <!-- Bootstrap CSS CDN -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css"
        integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <!-- Our Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
    <!-- Date picker -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.css">

    <!-- Font Awesome JS -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js"
        integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ"
        crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js"
        integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY"
        crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/brands.js" crossorigin="anonymous"></script>


</head>

<body>

    <div class="wrapper">
        <!-- Sidebar -->
        <nav id="sidebar">
            <div id="dismiss" hidden="true">
                <i class="fas fa-arrow-left"></i>
            </div>

            <!-- <div class="sidebar-header">
                <h3>Side Bar Header</h3>
            </div> -->

            <ul class="list-unstyled components">
                <li>
                    <div value="schedule">
                        <i class="fas fa-book"></i>
                        <span>Ders Programı</span>
                    </div>
                </li>
                <li>
                    <div value="courseInfo">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Kurullar</span>
                    </div>
                </li>
                <li>
                    <div value="labInfo">
                        <i class="fas fa-vial"></i>
                        <span>Pratikler</span>
                    </div>
                </li>
                <!-- TODO: Implement food menu-->
                <!-- <li>
                    <div value="foodMenu">
                        <i class="fas fa-utensils"></i>
                        <span>Yemek Programı</span>
                    </div>
                </li> -->
                <li>
                    <a href="#settingsSubmenu" data-toggle="collapse" aria-expanded="false"
                        class="dropdown-toggle collapsed" id="settings">
                        <i class="fas fa-sliders-h"></i>
                        <span>Ayarlar</span>
                    </a>
                    <ul class="collapse list-unstyled" id="settingsSubmenu">
                        <li>
                            <div class="container-fluid center" id="settingsContainer">
                            </div>
                        </li>
                    </ul>
                </li>
                <li>
                    <a href="#">
                        <i class="fab fa-github"></i>
                        <span>Info</span></a>
                </li>
            </ul>
        </nav>

        <!-- Page Content Holder -->
        <div id="content">

            <div class="d-flex">
                <button type="button" id="sidebarCollapse" class="navbar-btn m-2">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <div class="datepicker date input-group m-1">
                    <input type="text" class="form-control" id="datepicker">
                    <div class="input-group-append"><span class="input-group-text"><i
                                class="fas fa-calendar-alt"></i></span></div>
                </div>
            </div>



            <div id='list-container'>
                <ul class="list-group" id="content-list-group">
                    <!-- TODO: Add empty view -->
                </ul>
            </div>
        </div>

        <!-- jQuery CDN -->
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
        <!-- Popper.JS -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"
            integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
            crossorigin="anonymous"></script>
        <!-- Bootstrap JS -->
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"
            integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm"
            crossorigin="anonymous"></script>

        <!-- Bootstrap Datepicker and TR locale -->
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
        <script src="js/bootstrap-datepicker.tr.min.js" charset="UTF-8"></script>

        <script src="js/utils.js" charset="UTF-8"></script>
        <script src="js/data.js" charset="UTF-8"></script>
        <script src="js/listutils.js" charset="UTF-8"></script>
        <script src="js/cookie.js" charset="UTF-8"></script>

        <script type="text/javascript">
            $(document).ready(function () {

                var dataJson = null;
                var itemType = 'courseInfo';

                function updateDataAndUI(json) {
                    if (typeof itemType === 'undefined') {
                        itemType = 'courseInfo';
                    }
                    dataJson = json;
                    updateUI(dataJson, itemType);
                }

                let today = getDateFormatted(new Date(), '.');
                $("#datepicker").attr("value", today);

                $('.datepicker').datepicker({
                    language: "tr",
                    format: "dd.mm.yyyy",
                    todayBtn: true,
                    autoclose: true,
                    todayHighlight: true,
                    defaultViewDate: today
                }).on("changeDate", function(e) {
                        // `e` here contains the extra attributes
                        if (itemType == 'schedule' || itemType == 'labInfo') {
                            let selectedDate = getDateFormatted(e.date, '.');
                            console.log(selectedDate);
                            $("#datepicker").attr("value", selectedDate);
                            updateUI(dataJson, itemType);
                        } 
                });
                
                
                $.getJSON(getResourceUrl(itemType), updateDataAndUI);

                document.getElementById("settingsContainer").appendChild(createElement("div", '', 'Sınıf'))
                document.getElementById("settingsContainer").appendChild(createToggleButtonGroup(["1", "2", "3"], "grade", getCookie("grade")));
                $('#grade label').click(function() {
                    $(this).addClass('active').siblings().removeClass('active');
                    setCookie("grade", $(this).attr("value"));
                    itemType = "courseInfo";
                    let resUrl = getResourceUrl(itemType);
                    console.log("Grade changed", resUrl, itemType);
                    $.getJSON(resUrl, updateDataAndUI);
                });

                document.getElementById("settingsContainer").appendChild(createElement("div", '', 'Amfi'))
                document.getElementById("settingsContainer").appendChild(createToggleButtonGroup(["1", "2", "EN1"], "class", getCookie("class")));
                $('#class label').click(function() {
                    $(this).addClass('active').siblings().removeClass('active');
                    setCookie("class", $(this).attr("value"));
                    itemType = "courseInfo";
                    let resUrl = getResourceUrl(itemType);
                    console.log("Class changed", resUrl, itemType);
                    $.getJSON(resUrl, updateDataAndUI);
                });

                document.getElementById("settingsContainer").appendChild(createElement("div", '', 'Grup'))
                document.getElementById("settingsContainer").appendChild(createToggleButtonGroup(["TRA", "TRB", "EN"], "customGroup", getCookie("group").replace(/TR\d/, "TR")));
                $('#customGroup label').click(function() {
                    $(this).addClass('active').siblings().removeClass('active');
                    let newGroup = $(this).attr("value").replace("TR", "TR" + getCookie("grade"));
                    console.log("New group", newGroup)
                    setCookie("group", newGroup);
                    $('#subGroup label').removeClass("active");
                    $('#group label').removeClass("active");
                    setCookie("subGroup", "");
                    itemType = "courseInfo";
                    let resUrl = getResourceUrl(itemType);
                    console.log("Group changed", resUrl, itemType);
                    $.getJSON(resUrl, updateDataAndUI);
                });
                document.getElementById("settingsContainer").appendChild(createToggleButtonGroup(["1", "2", "3", "4"], "group", getCookie("group")));
                $('#group label').click(function() {
                    $(this).addClass('active').siblings().removeClass('active');
                    $('#customGroup label').removeClass("active");
                    setCookie("group", $(this).attr("value"));
                    itemType = "courseInfo";
                    let resUrl = getResourceUrl(itemType);
                    console.log("Group changed", resUrl, itemType);
                    $.getJSON(resUrl, updateDataAndUI);
                });

                document.getElementById("settingsContainer").appendChild(createElement("div", '', 'Alt Grup'))
                document.getElementById("settingsContainer").appendChild(createToggleButtonGroup(["A", "B"], "subGroup", getCookie("subGroup")));
                $('#subGroup label').click(function() {
                    $(this).addClass('active').siblings().removeClass('active');
                    $('#customGroup label').removeClass("active");
                    setCookie("subGroup", $(this).attr("value"));
                    itemType = "courseInfo";
                    let resUrl = getResourceUrl(itemType);
                    console.log("Subgroup changed", resUrl, itemType);
                    $.getJSON(resUrl, updateDataAndUI);
                });


                $('#sidebarCollapse').on('click', function () {
                    $('#sidebar').toggleClass('active');
                    $(this).toggleClass('active');
                });

                

                $("#sidebar ul li div").on('click', function() {
                    let clickedType = $(this).attr('value');
                    if (itemType != clickedType) {
                        itemType = clickedType;
                        let resUrl = getResourceUrl(itemType);
                        $.getJSON(resUrl, updateDataAndUI);
                    }
                })
            

                function updateList(itemType) {
                    var listGroup = document.getElementById('content-list-group');
                listGroup.textContent = ''
                for (var i = 0; i < 4; i++) {
                    switch (itemType) {
                        case "schedule":
                            listGroup.appendChild(createScheduleItem('09:00', "Tıbbi Biyoloji", "Hücre ve Hücre Araştırmalarına Genel Bakış", "Prof. Dr. İlhan Onaran"));
                            break;
                        case "foodMenu":
                            listGroup.appendChild(createFoodItem('Öğle', ["Çoban Kavurma", "Erişte", "Yoğurt"]));
                            break;
                        case "labInfo":
                            listGroup.appendChild(createLabItem("09.11.2020", "14:30", "Biyofizik"));
                            break;
                        case "courseInfo":
                            listGroup.appendChild(createCourseInfoItem('CTFT1002 / CTFI1002', 13, "03.11.2020",
                                " 24.12.2020", ["24.12.2020 11:00", "24.12.2020 11:00"], "22.01.2021 11:00", "22.01.2021 11:00"));
                            break;
                        default:
                        // code block
                    }
                }
                }
                
            });

        // TODO: Add click outside sidebar to collapse
        </script>
</body>

</html>